# Deploy to production server via SSH (git pull + ./scripts/deploy.sh).
#
# GitHub Secrets (Settings → Secrets and variables → Actions):
#   DEPLOY_HOST      = 209.38.43.31
#   DEPLOY_USER      = ubuntu          (or your SSH user)
#   SSH_PRIVATE_KEY  = contents of your private key (PEM, full file)
#   DEPLOY_PATH      = /home/ubuntu/uzahX   (path where repo is cloned on server)
#
# Trigger: manual (Run workflow) or on every push to main.

name: Deploy

on:
  workflow_dispatch: {}
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy on server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            set -e
            cd "${{ secrets.DEPLOY_PATH }}"
            git pull
            chmod +x scripts/deploy.sh 2>/dev/null || true
            ./scripts/deploy.sh
          script_stop: true